<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome page</title>
    <link rel="stylesheet" href="welcome.css">
</head>
<body>
    <h1 id="welcome"> Welcome </h1>
    <div id="create">
        <input type="text" id="addIn">
        <button id="addbtn">add</button>
    </div>
    <h3 style="display: flex; text-align: center; justify-content: center;">To do list display here</h3>
     <div id="filter">
        <button onclick="all()">All</button>
        <button onclick="Finish()">Finish</button>
        <button onclick="Unfinish()">Unfinish</button>
     </div>
    <div id="display"></div>
    <script>
    function all() {
        display();   // Just display all tasks (no reload)
    }

    function Finish() {
        const list = JSON.parse(localStorage.getItem("todoList")) || [];
        const displayBox = document.getElementById("display");
        displayBox.innerHTML = "";
        list.forEach((element, i) => {
            if (element.status === true) {
                displayBox.innerHTML += taskCard(element, i);
            }
        });
    }

    function Unfinish() {
        const list = JSON.parse(localStorage.getItem("todoList")) || [];
        const displayBox = document.getElementById("display");
        displayBox.innerHTML = "";
        list.forEach((element, i) => {
            if (element.status === false) {
                displayBox.innerHTML += taskCard(element, i);
            }
        });
    }

    // ðŸ”¥ UI reusable card generator
    function taskCard(element, i) {
        return `
        <div class="list">
            <input type="checkbox" class="check" id="check${i}" ${element.status ? "checked" : ""} onclick="check(${i})">
            <div class="name">${element.name}</div>
            <button onclick="edit(${i})">edit</button>
            <button onclick="dlt(${i})">dlt</button>
        </div>`;
    }

    function edit(i) {
        const list = JSON.parse(localStorage.getItem("todoList"));
        const rename = prompt("Rename task", list[i].name);
        if (rename !== null && rename.trim() !== "") {
            list[i].name = rename;
            localStorage.setItem("todoList", JSON.stringify(list));
        }
        display(); // refresh without page reload
    }

    function check(i) {
        const list = JSON.parse(localStorage.getItem("todoList"));
        list[i].status = !list[i].status;
        localStorage.setItem("todoList", JSON.stringify(list));
        display(); // refresh view
    }

    function dlt(i) {
        const list = JSON.parse(localStorage.getItem("todoList"));
        list.splice(i, 1);
        localStorage.setItem("todoList", JSON.stringify(list));
        display(); // refresh view
    }

    function display() {
        const list = JSON.parse(localStorage.getItem("todoList")) || [];
        const displayBox = document.getElementById("display");
        displayBox.innerHTML = "";
        list.forEach((element, i) => {
            displayBox.innerHTML += taskCard(element, i);
        });
    }

    // Display username
  const wel = document.getElementById("welcome");
const user = JSON.parse(localStorage.getItem("user"));

if (user && user.name) {
    wel.innerText = `Welcome ${user.name}`;
} else {
    wel.innerText = "Welcome User"; // fallback when no user stored
}

    // Add task button
    document.getElementById("addbtn").addEventListener("click", function () {
        const taskInput = document.getElementById("addIn");
        if (taskInput.value.trim() === "") return alert("Enter task");  // safety
        const list = JSON.parse(localStorage.getItem("todoList")) || [];
        list.push({ name: taskInput.value, status: false });
        localStorage.setItem("todoList", JSON.stringify(list));
        taskInput.value = "";
        display(); // refresh view
    });

    display(); // Load tasks at first
</script>
 
</body>
</html>