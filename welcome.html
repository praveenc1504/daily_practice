<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome page</title>
    <link rel="stylesheet" href="welcome.css">
</head>
<body>
    <h1 id="welcome"> Welcome </h1>
    <div id="create">
        <input type="text" id="addIn">
        <button id="addbtn">add</button>
    </div>
    <h3 style="display: flex; text-align: center; justify-content: center;">To do list display here</h3>
     <div id="filter">
        <button onclick="showAll()">All</button>
        <button onclick="showFinished()">Finish</button>
        <button onclick="showUnfinished()">Unfinish</button>
     </div>
    <div id="display"></div>
    <script>
    let currentFilter = 'all'; // Track current filter state

    function showAll() {
        currentFilter = 'all';
        display();
    }

    function showFinished() {
        currentFilter = 'finished';
        display();
    }

    function showUnfinished() {
        currentFilter = 'unfinished';
        display();
    }

    // ðŸ”¥ UI reusable card generator
    function taskCard(element, i) {
        return `
        <div class="list">
            <input type="checkbox" class="check" id="check${i}" ${element.status ? "checked" : ""} onclick="checkTask(${i})">
            <div class="name">${element.name}</div>
            <button onclick="editTask(${i})">edit</button>
            <button onclick="deleteTask(${i})">dlt</button>
        </div>`;
    }

    function editTask(i) {
        const list = JSON.parse(localStorage.getItem("todoList"));
        const rename = prompt("Rename task", list[i].name);
        if (rename !== null && rename.trim() !== "") {
            list[i].name = rename;
            localStorage.setItem("todoList", JSON.stringify(list));
        }
        display();
    }

    function checkTask(i) {
        const list = JSON.parse(localStorage.getItem("todoList"));
        list[i].status = !list[i].status;
        localStorage.setItem("todoList", JSON.stringify(list));
        display();
    }

    function deleteTask(i) {
        const list = JSON.parse(localStorage.getItem("todoList"));
        list.splice(i, 1);
        localStorage.setItem("todoList", JSON.stringify(list));
        display();
    }

    function display() {
        const list = JSON.parse(localStorage.getItem("todoList")) || [];
        const displayBox = document.getElementById("display");
        displayBox.innerHTML = "";
        
        let filteredList = list;
        
        // Apply filter based on currentFilter state
        if (currentFilter === 'finished') {
            filteredList = list.filter(element => element.status === true);
        } else if (currentFilter === 'unfinished') {
            filteredList = list.filter(element => element.status === false);
        }
        
        filteredList.forEach((element, i) => {
            // Find the original index to maintain proper functionality
            const originalIndex = list.findIndex(item => item === element);
            displayBox.innerHTML += taskCard(element, originalIndex);
        });
    }

    // Display username
    const wel = document.getElementById("welcome");
    const user = JSON.parse(localStorage.getItem("user"));

    if (user && user.name) {
        wel.innerText = `Welcome ${user.name}`;
    } else {
        wel.innerText = "Welcome User";
    }

    // Add task button
    document.getElementById("addbtn").addEventListener("click", function () {
        const taskInput = document.getElementById("addIn");
        if (taskInput.value.trim() === "") return alert("Enter task");
        const list = JSON.parse(localStorage.getItem("todoList")) || [];
        list.push({ name: taskInput.value, status: false });
        localStorage.setItem("todoList", JSON.stringify(list));
        taskInput.value = "";
        display();
    });

    // Also allow adding task with Enter key
    document.getElementById("addIn").addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
            document.getElementById("addbtn").click();
        }
    });

    display(); // Load tasks at first
</script>
 
</body>
</html>